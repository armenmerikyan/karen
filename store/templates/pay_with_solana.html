<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Payment App</title>
    <script src="https://cdn.jsdelivr.net/npm/buffer@6.0.3/index.min.js"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
</head>
<body>
    <h1>Solana Payment App</h1>
    <button id="connectWallet">Connect Wallet</button>
    <button id="makePayment" disabled>Pay with Solana</button>

    <script>
        // Solana Web3.js is available as `solanaWeb3` globally
        const { Connection, PublicKey, Transaction, SystemProgram } = solanaWeb3;

        // Connect to Solana Mainnet (or Devnet for testing)
        const connection = new Connection("https://api.mainnet-beta.solana.com");

        // Wallet and payment variables
        let wallet;
        const recipient = new PublicKey('{{profile.wallet}}'); // Replace with recipient's wallet address
        const amount = 1 * 1000000000; // 1 SOL in lamports (1 SOL = 1,000,000,000 lamports)

        // Connect Wallet Button
        document.getElementById('connectWallet').addEventListener('click', async () => {
            if (window.solana && window.solana.isPhantom) {
                wallet = window.solana;
                try {
                    await wallet.connect();
                    alert('Wallet connected!');
                    document.getElementById('makePayment').disabled = false;
                } catch (err) {
                    console.error('Failed to connect wallet:', err);
                    alert('Failed to connect wallet.');
                }
            } else {
                alert('Phantom wallet not detected. Please install Phantom.');
            }
        });

        // Make Payment Button
        document.getElementById('makePayment').addEventListener('click', async () => {
            if (!wallet) {
                alert('Please connect your wallet first.');
                return;
            }

            try {
                // Create a transaction
                const transaction = new Transaction().add(
                    SystemProgram.transfer({
                        fromPubkey: wallet.publicKey,
                        toPubkey: recipient,
                        lamports: amount,
                    })
                );

                // Set recent blockhash and fee payer
                const { blockhash } = await connection.getRecentBlockhash();
                transaction.recentBlockhash = blockhash;
                transaction.feePayer = wallet.publicKey;

                // Sign and send the transaction
                const signedTransaction = await wallet.signTransaction(transaction);
                const signature = await connection.sendRawTransaction(signedTransaction.serialize());

                alert(`Payment successful! Transaction signature: ${signature}`);
            } catch (err) {
                console.error('Payment failed:', err);
                alert('Payment failed. Please try again.');
            }
        });
    </script>
</body>
</html>